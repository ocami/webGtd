import db from "../repository/fireBase_repository"
import dateTimeTools from '../tools/DateTime.js'
import Action_store from '../store/Action_store'


var Promise = require('es6-promise').Promise;

class ActionsList_store {
    constructor() {
        this.receipt = {
            index: 0,
            name: 'receipt',
            toString: 'Réception',
            toSwitch: 'todo',
            acceptSwitch: {todo: 'true', done: true, incubation: true, destroy: true},
            defaultSearch: [
                {
                    name: 'project',
                    value: null,
                    toString: 'project',
                    min: null,
                    max: null,
                    interval: false,
                    button: false
                },
                {
                    name: 'location',
                    value: null,
                    toString: 'Location',
                    min: null,
                    max: null,
                    interval: false,
                    button: false
                },
                {
                    name: 'contact',
                    value: null,
                    toString: 'Contact',
                    min: null,
                    max: null,
                    interval: false,
                    button: false
                },
                {name: 'tools', value: null, toString: 'Outils', min: null, max: null, interval: false, button: false},
                {
                    name: 'priority',
                    value: null,
                    toString: 'Priorité',
                    min: null,
                    max: null,
                    interval: false,
                    button: false
                },
                {
                    name: 'duration',
                    value: null,
                    toString: 'Durée',
                    min: null,
                    max: null,
                    interval: false,
                    button: false
                },
                {name: 'date', value: null, toString: 'Date', min: null, max: null, interval: false, button: false},
            ],
            currentSearch: [
                {
                    name: 'project',
                    value: null,
                    toString: 'project',
                    min: null,
                    max: null,
                    interval: false,
                    button: false
                },
                {
                    name: 'location',
                    value: null,
                    toString: 'Location',
                    min: null,
                    max: null,
                    interval: false,
                    button: false
                },
                {
                    name: 'contact',
                    value: null,
                    toString: 'Contact',
                    min: null,
                    max: null,
                    interval: false,
                    button: false
                },
                {name: 'tools', value: null, toString: 'Outils', min: null, max: null, interval: false, button: false},
                {
                    name: 'priority',
                    value: null,
                    toString: 'Priorité',
                    min: null,
                    max: null,
                    interval: false,
                    button: false
                },
                {
                    name: 'duration',
                    value: null,
                    toString: 'Durée',
                    min: null,
                    max: null,
                    interval: false,
                    button: false
                },
                {name: 'date', value: null, toString: 'Date', min: null, max: null, interval: false, button: false},
            ],
            sortAsc: true,
            sortTag: 'autoTag-0',
            sortAscDefault: true,
            sortTagDefault: 'autoTag-0',
            list: []
        }
        this.todo = {
            index: 1,
            name: 'todo',
            toString: 'A faire',
            toSwitch: 'done',
            acceptSwitch: {todo: false, done: true, incubation: true, destroy: true},
            defaultSearch: [
                {
                    name: 'project',
                    value: null,
                    toString: 'project',
                    min: null,
                    max: null,
                    interval: false,
                    button: false
                },
                {
                    name: 'location',
                    value: null,
                    toString: 'Location',
                    min: null,
                    max: null,
                    interval: false,
                    button: false
                },
                {
                    name: 'contact',
                    value: null,
                    toString: 'Contact',
                    min: null,
                    max: null,
                    interval: false,
                    button: false
                },
                {name: 'tools', value: null, toString: 'Outils', min: null, max: null, interval: false, button: false},
                {
                    name: 'priority',
                    value: null,
                    toString: 'Priorité',
                    min: null,
                    max: null,
                    interval: false,
                    button: false
                },
                {
                    name: 'duration',
                    value: null,
                    toString: 'Durée',
                    min: null,
                    max: null,
                    interval: false,
                    button: false
                },
                {name: 'date', value: null, toString: 'Date', min: null, max: null, interval: false, button: false},
            ],
            currentSearch: [
                {
                    name: 'project',
                    value: null,
                    toString: 'project',
                    min: null,
                    max: null,
                    interval: false,
                    button: false
                },
                {
                    name: 'location',
                    value: null,
                    toString: 'Location',
                    min: null,
                    max: null,
                    interval: false,
                    button: false
                },
                {
                    name: 'contact',
                    value: null,
                    toString: 'Contact',
                    min: null,
                    max: null,
                    interval: false,
                    button: false
                },
                {name: 'tools', value: null, toString: 'Outils', min: null, max: null, interval: false, button: false},
                {
                    name: 'priority',
                    value: null,
                    toString: 'Priorité',
                    min: null,
                    max: null,
                    interval: false,
                    button: false
                },
                {
                    name: 'duration',
                    value: null,
                    toString: 'Durée',
                    min: null,
                    max: null,
                    interval: false,
                    button: false
                },
                {name: 'date', value: null, toString: 'Date', min: null, max: null, interval: false, button: false},
            ],
            sortAsc: true,
            sortTag: 'autoTag-0',
            sortAscDefault: true,
            sortTagDefault: 'autoTag-0',
            list: []
        }
        this.done = {
            index: 2,
            name: 'done',
            toString: 'Fait',
            toSwitch: 'destroy',
            acceptSwitch: {todo: true, done: false, incubation: false, destroy: true},
            defaultSearch: [
                {
                    name: 'project',
                    value: null,
                    toString: 'project',
                    min: null,
                    max: null,
                    interval: false,
                    button: false
                },
                {
                    name: 'location',
                    value: null,
                    toString: 'Location',
                    min: null,
                    max: null,
                    interval: false,
                    button: false
                },
                {
                    name: 'contact',
                    value: null,
                    toString: 'Contact',
                    min: null,
                    max: null,
                    interval: false,
                    button: false
                },
                {name: 'tools', value: null, toString: 'Outils', min: null, max: null, interval: false, button: false},
                {
                    name: 'priority',
                    value: null,
                    toString: 'Priorité',
                    min: null,
                    max: null,
                    interval: false,
                    button: false
                },
                {
                    name: 'duration',
                    value: null,
                    toString: 'Durée',
                    min: null,
                    max: null,
                    interval: false,
                    button: false
                },
                {name: 'date', value: null, toString: 'Date', min: null, max: null, interval: false, button: false},
            ],
            currentSearch: [
                {
                    name: 'project',
                    value: null,
                    toString: 'project',
                    min: null,
                    max: null,
                    interval: false,
                    button: false
                },
                {
                    name: 'location',
                    value: null,
                    toString: 'Location',
                    min: null,
                    max: null,
                    interval: false,
                    button: false
                },
                {
                    name: 'contact',
                    value: null,
                    toString: 'Contact',
                    min: null,
                    max: null,
                    interval: false,
                    button: false
                },
                {name: 'tools', value: null, toString: 'Outils', min: null, max: null, interval: false, button: false},
                {
                    name: 'priority',
                    value: null,
                    toString: 'Priorité',
                    min: null,
                    max: null,
                    interval: false,
                    button: false
                },
                {
                    name: 'duration',
                    value: null,
                    toString: 'Durée',
                    min: null,
                    max: null,
                    interval: false,
                    button: false
                },
                {name: 'date', value: null, toString: 'Date', min: null, max: null, interval: false, button: false},
            ],
            sortAsc: true,
            sortTag: 'autoTag-0',
            sortAscDefault: true,
            sortTagDefault: 'autoTag-0',
            list: []
        }
        this.incubation = {
            index: 3,
            name: 'incubation',
            toString: 'Incubation',
            toSwitch: 'todo',
            acceptSwitch: {todo: true, done: false, incubation: false, destroy: true},
            defaultSearch: [
                {
                    name: 'project',
                    value: null,
                    toString: 'project',
                    min: null,
                    max: null,
                    interval: false,
                    button: false
                },
                {
                    name: 'location',
                    value: null,
                    toString: 'Location',
                    min: null,
                    max: null,
                    interval: false,
                    button: false
                },
                {
                    name: 'contact',
                    value: null,
                    toString: 'Contact',
                    min: null,
                    max: null,
                    interval: false,
                    button: false
                },
                {name: 'tools', value: null, toString: 'Outils', min: null, max: null, interval: false, button: false},
                {
                    name: 'priority',
                    value: null,
                    toString: 'Priorité',
                    min: null,
                    max: null,
                    interval: false,
                    button: false
                },
                {
                    name: 'duration',
                    value: null,
                    toString: 'Durée',
                    min: null,
                    max: null,
                    interval: false,
                    button: false
                },
                {name: 'date', value: null, toString: 'Date', min: null, max: null, interval: false, button: false},
            ],
            currentSearch: [
                {
                    name: 'project',
                    value: null,
                    toString: 'project',
                    min: null,
                    max: null,
                    interval: false,
                    button: false
                },
                {
                    name: 'location',
                    value: null,
                    toString: 'Location',
                    min: null,
                    max: null,
                    interval: false,
                    button: false
                },
                {
                    name: 'contact',
                    value: null,
                    toString: 'Contact',
                    min: null,
                    max: null,
                    interval: false,
                    button: false
                },
                {name: 'tools', value: null, toString: 'Outils', min: null, max: null, interval: false, button: false},
                {
                    name: 'priority',
                    value: null,
                    toString: 'Priorité',
                    min: null,
                    max: null,
                    interval: false,
                    button: false
                },
                {
                    name: 'duration',
                    value: null,
                    toString: 'Durée',
                    min: null,
                    max: null,
                    interval: false,
                    button: false
                },
                {name: 'date', value: null, toString: 'Date', min: null, max: null, interval: false, button: false},
            ],
            sortAsc: true,
            sortTag: 'autoTag-0',
            sortAscDefault: true,
            sortTagDefault: 'autoTag-0',
            list: []
        }
        this.destroy = {
            index: 4,
            name: 'destroy',
            toString: 'Corbeille',
            toSwitch: 'todo',
            acceptSwitch: {todo: true, done: false, incubation: true, destroy: false},
            defaultSearch: [
                {
                    name: 'project',
                    value: null,
                    toString: 'project',
                    min: null,
                    max: null,
                    interval: false,
                    button: false
                },
                {
                    name: 'location',
                    value: null,
                    toString: 'Location',
                    min: null,
                    max: null,
                    interval: false,
                    button: false
                },
                {
                    name: 'contact',
                    value: null,
                    toString: 'Contact',
                    min: null,
                    max: null,
                    interval: false,
                    button: false
                },
                {name: 'tools', value: null, toString: 'Outils', min: null, max: null, interval: false, button: false},
                {
                    name: 'priority',
                    value: null,
                    toString: 'Priorité',
                    min: null,
                    max: null,
                    interval: false,
                    button: false
                },
                {
                    name: 'duration',
                    value: null,
                    toString: 'Durée',
                    min: null,
                    max: null,
                    interval: false,
                    button: false
                },
                {name: 'date', value: null, toString: 'Date', min: null, max: null, interval: false, button: false},
            ],
            currentSearch: [
                {
                    name: 'project',
                    value: null,
                    toString: 'project',
                    min: null,
                    max: null,
                    interval: false,
                    button: false
                },
                {
                    name: 'location',
                    value: null,
                    toString: 'Location',
                    min: null,
                    max: null,
                    interval: false,
                    button: false
                },
                {
                    name: 'contact',
                    value: null,
                    toString: 'Contact',
                    min: null,
                    max: null,
                    interval: false,
                    button: false
                },
                {name: 'tools', value: null, toString: 'Outils', min: null, max: null, interval: false, button: false},
                {
                    name: 'priority',
                    value: null,
                    toString: 'Priorité',
                    min: null,
                    max: null,
                    interval: false,
                    button: false
                },
                {
                    name: 'duration',
                    value: null,
                    toString: 'Durée',
                    min: null,
                    max: null,
                    interval: false,
                    button: false
                },
                {name: 'date', value: null, toString: 'Date', min: null, max: null, interval: false, button: false},
            ],
            sortAsc: true,
            sortTag: 'autoTag-0',
            sortAscDefault: true,
            sortTagDefault: 'autoTag-0',
            list: []
        }
        this.data = {
            currentList: this.todo,
            actionsList: {
                receipt: this.receipt,
                todo: this.todo,
                done: this.done,
                incubation: this.incubation,
                destroy: this.destroy,
                tags: []
            },
        }
    }

    setCurrent(name) {
        console.log('>> ActionsList_store/setCurrent')
        this.data.currentList = this.data.actionsList[name]
        Action_store.setCurrentByIndex(0)
    }

    getOneListByName(name) {
        console.log('>> ActionsList_store/getOneListByName')
        return this.data.actionsList[name]
    }

    allVisible() {
        let list = this.data.currentList.list

        for (var i = 0; i < list.length; i++) {
            list[i].visible = true
        }
    }

    getFirstVisible() {
        let list = this.data.currentList.list

        for (var i = 0; i < list.length; i++) {
            if (this.data.currentList.list[i].visible === true) {
                return i
            }

            return null
        }
    }

    sortByTag(tag, ascending) {

        if(tag.nature === 'autoTag'){
            this.sortByAutoTag(tag.name, ascending)
            return
        }

        let tagName = tag.name

        let currentList = this.data.currentList
        let actions = currentList.list.slice()
        let tagsCompare = function (ascending) {
            return function (a, b) {
                let indexA = a.tags.map(function (e) {
                    return e.name
                }).indexOf(tagName)
                let indexB = b.tags.map(function (e) {
                    return e.name
                }).indexOf(tagName)

                if (!a.tags[indexA].value) {
                    return 1;
                }
                else if (!b.tags[indexB].value) {
                    return -1;
                }
                else if (a.tags[indexA].value === b.tags[indexB].value) {
                    return 1;
                }
                else if (ascending) {
                    return a.tags[indexA].value < b.tags[indexB].value ? -1 : 1;
                }
                else if (!ascending) {
                    return a.tags[indexA].value < b.tags[indexB].value ? 1 : -1;
                }
            };
        }
        currentList.list = actions.sort(tagsCompare(ascending))
    }

    sortByAutoTag(tagName, ascending) {

        let currentList = this.data.currentList
        let actions = currentList.list.slice()

        let tagsCompare = function (ascending) {
            return function (a, b) {
                if (a.autoTags[tagName] === b.autoTags[tagName]) {
                    return 0;
                }
                else if (ascending) {
                    return a.autoTags[tagName] < b.autoTags[tagName] ? -1 : 1;
                }
                else if (!ascending) {
                    return a.autoTags[tagName] < b.autoTags[tagName] ? 1 : -1;
                }
            };
        }
        currentList.list = actions.sort(tagsCompare(ascending))
    }

    tagsCompare(search) {
        console.log('> ActionsList_store/tagsCompare')

        let cl = this.data.currentList
        let actions = cl.list.slice()

        if (!search)
            search = cl.currentSearch

        for (let i = 0; i < actions.length; i++)
            actions[i].visible = this.arrayCompare(actions[i], search)

        cl.list = actions;
    }

    arrayCompare(currentAction, search) {
        console.log('> ActionsList_store/arrayCompare')

        for (var i = 0; i < search.length; i++) {
            let tagName = search[i].name
            let value = search[i].value
            let actionTagValue = Action_store.getTagByName(tagName).value

            if (search[i].interval)
                if (!this.arrayIntervalCompare(search[i], actionTagValue))
                    return false

            if (value)
                if (value !== actionTagValue)
                    return false
        }
        return true
    }

    arrayIntervalCompare(searchTag, actionTagValue) {
        console.log('> app_store/arrayIntervalCompare')

        let min = searchTag.min
        let max = searchTag.max

        if (min && max)
            if (actionTagValue >= min && actionTagValue <= max)
                return true

        if (min && !max)
            if (actionTagValue >= min)
                return true

        if (!min && max)
            if (actionTagValue <= max)
                return true

        return false
    }


    add() {

    }

    update() {

    }

    getTagByName() {

    }

}

export default new ActionsList_store();


